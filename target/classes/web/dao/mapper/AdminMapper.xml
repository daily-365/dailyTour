<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="web.dao.face.AdminDAO">
  
  <!-- 회원목록 전체조회  (관리자 제외)-->
  
  <select id="AllMemberList" resultType="web.dto.MemberDTO">
   select userNo,userId,userPw,userName,userBirth1,userBirth2,userBirth3,userGender,userPhone,userMail,verify,regiDate
  from tbl_member
  where verify=0
  order by userNo desc
  </select>
  
  <sql id="memberSearch">
    <if test="searchType=='id'.toString()">where userId like '%'||#{keyword}||'%' </if>
   <if test="searchType=='name'.toString()">where userName like '%'||#{keyword}||'%' </if>
    <if test="searchType=='grade'.toString()">where userGrade like '%'||#{keyword}||'%' </if>
  </sql>
  
  <select id="listMemberPage" resultType="web.dto.MemberDTO"> 
  select userNo,userId,userPw,userName,userBirth1,userBirth2,userBirth3,userGender,userPhone,userMail,verify,regiDate
  from 
  (select  userNo,userId,userPw,userName,userBirth1,userBirth2,userBirth3,userGender,userPhone,userMail,verify,regiDate,
      row_number() over(order by userNo desc )   as rnum
        from tbl_member 
        <include refid="memberSearch"></include>
        ) m
        where
         rnum between #{rowStart} and #{rowEnd}
         and verify =0
          order by userNo desc
      </select>
  
  <select id="listMemberCount" resultType="int">
    select count(*)
    from tbl_member
    where 
    <include refid="memberSearch"></include>
     <![CDATA[
 userNo > 0
]]>
    </select>
  
  
   <insert id="writeBoard">
    insert into tbl_board (boardNo,boardTitle,boardContent,writeId)
    values (tbl_board_seq.nextVal,#{boardTitle},#{boardContent},#{writeId})
     
   </insert>
  
   <select id="listBoard" resultType="web.dto.BoardDTO">
   select boardNo,boardTitle,boardContent,boardDate,boardVisit,writeId
   from tbl_board 
   order by boardNo desc
      </select>
   
    <select id="viewBoard" resultType="web.dto.BoardDTO">
   select boardNo,boardTitle,boardContent,boardDate,boardVisit,writeId
   from tbl_board 
   where boardNo = #{boardNo}
   
   </select>
   
   
     
   <!-- 검색  -->
   
    <sql id="BoardSearch">
 <if test="searchType != null">
  <if test="searchType == 't'.toString()">where boardTitle like '%' || #{keyword} || '%'</if>
  <if test="searchType == 'c'.toString()">where boardContent like '%' || #{keyword} || '%'</if>
   <if test="searchType == 'w'.toString()">where writeId like '%' || #{keyword} || '%'</if>
   <if test="searchType == 'tc'.toString()">where (boardTitle like '%' || #{keyword} || '%') or (boardContent like '%' || #{keyword} || '%')</if>
 </if>
</sql>
   
   <!-- 총 게시글 갯수 출력 -->
   <select id="listBoardPage"  resultType="web.dto.BoardDTO" >
     select boardNo,boardTitle,boardContent,boardDate,boardVisit,writeId
     from 
     (select boardNo,boardTitle,boardContent,boardDate,boardVisit,writeId, 
        row_number() over (order by boardNo desc ) as rnum 
        from tbl_board 
         <include refid="BoardSearch"></include>
          ) b
           where rnum between #{rowStart} and #{rowEnd}
          order by boardNo desc
        
   </select>
   
    <!-- 총 게시글 출력 -->
   <select id="listBoardCount" resultType="int">
   
    select count(boardNo)
    from tbl_board
    where
    <include refid="BoardSearch"></include>
    <![CDATA[
 boardNo > 0
]]>
</select>
   
    <!-- 조회수 증가 -->
   <update id="visitCount" parameterType="int">
     update tbl_board
     set boardVisit = boardVisit+1
     where boardNo=#{boardNo}
   
   </update>
   
   
   <!-- 게시글 수정 -->
    <update id="updateBoard" parameterType="int">
     update tbl_board
     set boardTitle = #{boardTitle} ,boardContent = #{boardContent}
     where boardNo= #{boardNo}
       
    </update>
  
   <!-- 게시글 삭제 -->
   <delete id="deleteBoard" parameterType="web.dto.BoardDTO">
    delete from tbl_board
    where boardNo = #{boardNo}
   
   
   </delete>
  
  </mapper>